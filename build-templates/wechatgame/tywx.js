var e={};(function(){var t="Default";e.StateInfo={debugMode:!0,networkConnected:!0,networkType:"none"},e.SystemInfo={clientId:"H5_2.0_weixin.weixin.0-hall20197.weixin.elsfkptnew",intClientId:38096,cloudId:8,version:1.01,webSocketUrl:"",loginUrl:"https://xyxsf.nalrer.cn/",shareManagerUrl:"https://market.tuyoo.com/",deviceId:"wechatGame",wxAppId:"wx45e02fc734c7b568",appId:20197,gameId:20197,hall_version:"hall37",cdnPath:"",remotePackPath:"",biLogServer:"https://cbi.tuyoo.com/api/bilog5/text",gaLogServer:"https://cbi.tuyoo.com/api/bilog5/ga",errorLogServer:"https://clienterr.tuyoo.com/api/bilog5/text/error",tywxVersion:"1.7.5_20240701_release",openFeatureFilter:!1,wxPayVersion:"2.0"},e.UserInfo={userId:0,userName:"TuWechatGame",userPic:"",authorCode:"",systemType:0,wechatType:t,model:t,system:t,platform:t,language:t,benchmarkLevel:t,scene_id:"",scene_param:"",invite_id:0,wxgame_session_key:"",signature:"",encryptedData:"",iv:"",wxUserInfo:{},extraParams:{}}})(),e.LOGD=function(t,r){e.StateInfo.debugMode&&(t=t||"tywx")},e.LOGE=function(t,r){e.StateInfo.debugMode&&(t=t||"tywx")},e.IsWechatPlatform=function(){try{return wx,!0}catch(e){return!1}},function(){function t(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,s=-271733879,d=-1732584194,l=271733878,f=0;f<e[_];f+=16){var u=r,h=s,p=d,I=l;r=n(r,s,d,l,e[f+0],7,-680876936),l=n(l,r,s,d,e[f+1],12,-389564586),d=n(d,l,r,s,e[f+2],17,606105819),s=n(s,d,l,r,e[f+3],22,-1044525330),r=n(r,s,d,l,e[f+4],7,-176418897),l=n(l,r,s,d,e[f+5],12,1200080426),d=n(d,l,r,s,e[f+6],17,-1473231341),s=n(s,d,l,r,e[f+7],22,-45705983),r=n(r,s,d,l,e[f+8],7,1770035416),l=n(l,r,s,d,e[f+9],12,-1958414417),d=n(d,l,r,s,e[f+10],17,-42063),s=n(s,d,l,r,e[f+11],22,-1990404162),r=n(r,s,d,l,e[f+12],7,1804603682),l=n(l,r,s,d,e[f+13],12,-40341101),d=n(d,l,r,s,e[f+14],17,-1502002290),r=i(r,s=n(s,d,l,r,e[f+15],22,1236535329),d,l,e[f+1],5,-165796510),l=i(l,r,s,d,e[f+6],9,-1069501632),d=i(d,l,r,s,e[f+11],14,643717713),s=i(s,d,l,r,e[f+0],20,-373897302),r=i(r,s,d,l,e[f+5],5,-701558691),l=i(l,r,s,d,e[f+10],9,38016083),d=i(d,l,r,s,e[f+15],14,-660478335),s=i(s,d,l,r,e[f+4],20,-405537848),r=i(r,s,d,l,e[f+9],5,568446438),l=i(l,r,s,d,e[f+14],9,-1019803690),d=i(d,l,r,s,e[f+3],14,-187363961),s=i(s,d,l,r,e[f+8],20,1163531501),r=i(r,s,d,l,e[f+13],5,-1444681467),l=i(l,r,s,d,e[f+2],9,-51403784),d=i(d,l,r,s,e[f+7],14,1735328473),r=o(r,s=i(s,d,l,r,e[f+12],20,-1926607734),d,l,e[f+5],4,-378558),l=o(l,r,s,d,e[f+8],11,-2022574463),d=o(d,l,r,s,e[f+11],16,1839030562),s=o(s,d,l,r,e[f+14],23,-35309556),r=o(r,s,d,l,e[f+1],4,-1530992060),l=o(l,r,s,d,e[f+4],11,1272893353),d=o(d,l,r,s,e[f+7],16,-155497632),s=o(s,d,l,r,e[f+10],23,-1094730640),r=o(r,s,d,l,e[f+13],4,681279174),l=o(l,r,s,d,e[f+0],11,-358537222),d=o(d,l,r,s,e[f+3],16,-722521979),s=o(s,d,l,r,e[f+6],23,76029189),r=o(r,s,d,l,e[f+9],4,-640364487),l=o(l,r,s,d,e[f+12],11,-421815835),d=o(d,l,r,s,e[f+15],16,530742520),r=a(r,s=o(s,d,l,r,e[f+2],23,-995338651),d,l,e[f+0],6,-198630844),l=a(l,r,s,d,e[f+7],10,1126891415),d=a(d,l,r,s,e[f+14],15,-1416354905),s=a(s,d,l,r,e[f+5],21,-57434055),r=a(r,s,d,l,e[f+12],6,1700485571),l=a(l,r,s,d,e[f+3],10,-1894986606),d=a(d,l,r,s,e[f+10],15,-1051523),s=a(s,d,l,r,e[f+1],21,-2054922799),r=a(r,s,d,l,e[f+8],6,1873313359),l=a(l,r,s,d,e[f+15],10,-30611744),d=a(d,l,r,s,e[f+6],15,-1560198380),s=a(s,d,l,r,e[f+13],21,1309151649),r=a(r,s,d,l,e[f+4],6,-145523070),l=a(l,r,s,d,e[f+11],10,-1120210379),d=a(d,l,r,s,e[f+2],15,718787259),s=a(s,d,l,r,e[f+9],21,-343485551),r=c(r,u),s=c(s,h),d=c(d,p),l=c(l,I)}return Array(r,s,d,l)}function r(e,t,r,n,i,o){return c(function(e,t){return e<<t|e>>>32-t}(c(c(t,e),c(n,o)),i),r)}function n(e,t,n,i,o,a,s){return r(t&n|~t&i,e,t,o,a,s)}function i(e,t,n,i,o,a,s){return r(t&i|n&~i,e,t,o,a,s)}function o(e,t,n,i,o,a,s){return r(t^n^i,e,t,o,a,s)}function a(e,t,n,i,o,a,s){return r(n^(t|~i),e,t,o,a,s)}function s(e,r){var n=d(e);n[_]>16&&(n=t(n,e[_]*g));for(var i=Array(16),o=Array(16),a=0;a<16;a++)i[a]=909522486^n[a],o[a]=1549556828^n[a];var s=t(i.concat(d(r)),512+r[_]*g);return t(o.concat(s),640)}function c(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function d(e){for(var t=Array(),r=(1<<g)-1,n=0;n<e[_]*g;n+=g)t[n>>5]|=(e.charCodeAt(n/g)&r)<<n%32;return t}function l(e){for(var t="",r=(1<<g)-1,n=0;n<32*e[_];n+=g)t+=String.fromCharCode(e[n>>5]>>>n%32&r);return t}function f(e){for(var t=p?"0123456789ABCDEF":"0123456789abcdef",r="",n=0;n<4*e[_];n++)r+=t[h](e[n>>2]>>n%4*8+4&15)+t[h](e[n>>2]>>n%4*8&15);return r}function u(e){for(var t="",r=0;r<4*e[_];r+=3)for(var n=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,i=0;i<4;i++)8*r+6*i>32*e[_]?t+=I:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h](n>>6*(3-i)&63);return t}var _="length",h="charAt",p=0,I="",g=8;e.b64=function(e){return u(d(e),e[_])},e.hex_md5=function(e){return f(t(d(e),e[_]*g))},e.b64_md5=function(e){return u(t(d(e),e[_]*g))},e.str_md5=function(e){return l(t(d(e),e[_]*g))},e.hex_hmac_md5=function(e,t){return f(s(e,t))},e.b64_hmac_md5=function(e,t){return u(s(e,t))},e.str_hmac_md5=function(e,t){return l(s(e,t))}}(),e.GAEventType={SDK_LOGIN_START:"sdk_c_login_start",SDK_LOGIN_SUCC:"sdk_c_login_succ",SDK_LOGIN_FAIL:"sdk_c_login_fail",SDK_LOGIN_BY_CHANNEL_START:"sdk_c_login_by_channel_start",SDK_LOGIN_BY_CHANNEL_SUCC:"sdk_c_login_by_channel_succ",SDK_LOGIN_BY_CHANNEL_FAIL:"sdk_c_login_by_channel_fail",SDK_LOGIN_BY_SDKSERVER_START:"sdk_c_login_by_sdkserver_start",SDK_LOGIN_BY_SDKSERVER_SUCC:"sdk_c_login_by_sdkserver_succ",SDK_LOGIN_BY_SDKSERVER_FAIL:"sdk_c_login_by_sdkserver_fail",SDK_PAY_START:"sdk_c_pay_start",SDK_PAY_SUCC:"sdk_c_pay_succ",SDK_PAY_FAIL:"sdk_c_pay_fail"},e.EventType={SDK_LOGIN_SUCCESS:"sdk_login_success",SDK_LOGIN_FAIL:"sdk_login_fail",WEIXIN_LOGIN_SUCCESS:"weixin_login_success",WEIXIN_LOGIN_FAIL:"weixin_login_fail",GET_USER_FEATURE_SUCCESS:"GET_USER_FEATURE_SUCCESS",GET_USER_FEATURE_FAIL:"GET_USER_FEATURE_FAIL",GET_SHARE_CONFIG_SUCCESS:"GET_SHARE_CONFIG_SUCCESS",GET_SHARE_CONFIG_FAIL:"GET_SHARE_CONFIG_FAIL",GAME_SHOW:"GAME_SHOW",START_AUTHORIZATION_SUCCESS:"START_AUTHORIZATION_SUCCESS",START_AUTHORIZATION_FAILED:"START_AUTHORIZATION_FAILED",CREATE_PAY_ORDER_SUCCESS:"CREATE_PAY_ORDER_SUCCESS",CREATE_PAY_ORDER_FAIL:"CREATE_PAY_ORDER_FAIL",SDK_WX_PAY_SUCCESS:"SDK_WX_PAY_SUCCESS",SDK_WX_PAY_FAIL:"SDK_WX_PAY_FAIL",SET_WX_SENSITIVE_DATA_SUCCESS:"SET_WX_SENSITIVE_DATA_SUCCESS",SET_WX_SENSITIVE_DATA_FAIL:"SET_WX_SENSITIVE_DATA_FAIL",SET_WX_USER_INFO_SUCCESS:"SET_WX_USER_INFO_SUCCESS",SET_WX_USER_INFO_FAIL:"SET_WX_USER_INFO_FAIL",GET_ADMANAGER_ICON_INFO_SUCCESS:"GET_ADMANAGER_ICON_INFO_SUCCESS",GET_ADMANAGER_NEWICON_INFO_SUCCESS:"GET_ADMANAGER_NEWICON_INFO_SUCCESS"},e.clickStatEventType={clickStatEventTypeUserFrom:99990001,clickStatEventTypeUserShare:99990002,clickStatEventTypeClickFirstAd:99990003,clickStatEventTypeClickShowQRCode:99990004,clickStatEventTypeClickDirectToMiniGameSuccess:99990005,clickStatEventTypeClickDirectToMiniGameFail:99990006,clickStatEventTypeClickAdBtn:99990007,clickStatEventTypeAuthorizationStart:10004,clickStatEventTypeAuthorizationSuccess:10005,clickStatEventTypeAuthorizationFailed:10006},e.Util={localUuid:"",CheckPhoneNumber:function(e){return!!/^(13[0-9]|14[0-9]|15[0-9]|16[0-9]|17[0-9]|18[0-9]|19[0-9])\d{8}$/.test(e)},IsNull:function(e){return null==e||""===e},isSceneQrCode:function(e){return[1047,1048,1049].indexOf(e)>-1},createUUID:function(){for(var e=[],t="0123456789abcdef",r=0;r<36;r++)e[r]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="",e.join("")},getLocalUUID:function(){var t="localUuid",r="LOCAL_UUID_KEY";return this[t]||(this[t]=e.Util.getItemFromLocalStorage(r,""),this[t]||(this[t]=e.Util.createUUID(),e.Util.setItemToLocalStorage(r,this[t]),e.GALog.innerTrack(e.GALog.GA_TYPE.TRACK,"sdk_c_device_register",{}))),this[t]},getItemFromLocalStorage:function(e,t){try{var r=wx.getStorageSync(e);if(r)return r}catch(e){return t}},setItemToLocalStorage:function(t,r){try{wx.setStorage({key:t,data:r+""})}catch(t){e.LOGE("tywx.Util","setItemToLocalStorage fail")}}},e.ErrorLog={errorLocalCacheData:[],BiErrorInfo:null,initError:function(){var t="BiErrorInfo",r="SystemInfo",n="UserInfo";this[t]={},this[t].cloud_id=e[r].cloudId,this[t].user_id=e[n].userId,this[t].client_id=e[r].clientId,this[t].sys_version=e[n].system,this[t].mobile_models=e[n].model,this[t].baseVersion=e[n].sdkVersion,this[t].wxVersion=e[n].wechatType,this[t].clientVersion=e[r].version,this[t].Nettype=e.StateInfo.networkType,this[t].ip="",e.TuyooSDK.ipLocInfo&&(this[t].ip=e.TuyooSDK.ipLocInfo.ip)},uploadLogTimely:function(t){var r="BiErrorInfo";if(t&&"string"==typeof t){if(!e.StateInfo.networkConnected)return void e.LOGD("tywx.ErrorLog","net error!");e.ErrorLog.initError();var n=new Date;this[r].time=n.valueOf(),this[r].errMsg=t;var i=JSON.stringify(this[r]);this.saveCache(i);var o=e.GALog.getCacheWithLimitCount(this.errorLocalCacheData,10);this.reportErrorLog(o)}},reportErrorLog:function(t){var r="reportCacheData",n=e.GALog.processArray2String(t);if(t&&t.length>0){var i={url:e.SystemInfo.errorLogServer,header:{"Content-Type":"text/plain"},postData:n};e.LOGD("BILOG","reportErrorLog:"+n),e.HttpUtil.httpLimitPost(e.HttpUtil.httpLimitType.biLimit,i,(function(n){e.ErrorLog.deleteCache(t),e.GALog[r]()}),null)}else e.GALog[r]()},saveCache:function(e){var t="errorLocalCacheData";e&&(this[t]||(this[t]=[]),-1===this[t].indexOf(e)&&this[t].push(e),this[t].length>100&&this[t].shift())},deleteCache:function(e){var t="errorLocalCacheData";if(e&&this[t]){var r=this[t];e.forEach((function(e){r.indexOf(e)>-1&&r.splice(r.indexOf(e),1)}))}},reportCacheData:function(){var t=e.GALog.getCacheWithLimitCount(this.errorLocalCacheData,10);t&&t.length>0&&this.reportErrorLog(t)}},e.BiLog={biLocalCacheData:[],getSystemInfo:function(){var t="SystemInfo",r="0";this.cloud_id=e[t].cloudId,this.rec_type="1",this.rec_id=r,this.receive_time=r,this.user_id=e.UserInfo.userId||r,this.game_id=e[t].gameId,this.client_id=e[t].clientId,this.device_id=e.Util.getLocalUUID(),this.ip_addr="#IP",this.nettype=r,this.phone_maker=r,this.phone_model=e.UserInfo.model,this.phone_carrier=r,this.reserved=r},uploadClickStatLogTimely:function(t){var r="reportCacheData",n=e.GALog.processArray2String(t);if(t&&t.length>0){var i={url:e.SystemInfo.biLogServer,header:{"Content-Type":"text/plain"},postData:n};e.LOGD("BILOG","reportBiLog:"+n),e.HttpUtil.httpLimitPost(e.HttpUtil.httpLimitType.biLimit,i,(function(n){e.BiLog.deleteCache(t),e.GALog[r]()}),null)}else e.GALog[r]()},clickStat:function(t,r){var n=[];if((r=r||[]).length<10)for(var i=0;i<9;i++)i<r.length?n.push(r[i]):n.push(0);else n=r;e.LOGD("BI打点","eventid= "+t+" 描述 = "+JSON.stringify(n));var o=this.assemblelog(t,n);this.saveCache(o);var a=e.GALog.getCacheWithLimitCount(this.biLocalCacheData,10);this.uploadClickStatLogTimely(a)},assemblelog:function(e,t){var r="\t",n=(new Date).getTime();n-this._timetag>6e4&&(this._timetag=n,this.nettype=0);var i=t.join(r);this.getSystemInfo();var o=this.cloud_id+r+this.rec_type+r+n+r+this.rec_id+r+this.receive_time+r+e+r+this.user_id+r+this.game_id+r+this.client_id+r+this.device_id+r+this.ip_addr+r+this.nettype+r+this.phone_maker+r+this.phone_model+r+this.phone_carrier+r+i+r+this.reserved;return this.trimTab0(o)},trimTab0:function(e){return null==e||null==e?"":e.replace(/(\t0)*$/,"")},saveCache:function(e){var t="biLocalCacheData";e&&(this[t]||(this[t]=[]),-1===this[t].indexOf(e)&&this[t].push(e),this[t].length>100&&this[t].shift())},deleteCache:function(e){var t="biLocalCacheData";if(e&&this[t]){var r=this[t];e.forEach((function(e){r.indexOf(e)>-1&&r.splice(r.indexOf(e),1)}))}},reportCacheData:function(){var t=e.GALog.getCacheWithLimitCount(this.biLocalCacheData,10);t&&t.length>0?this.uploadClickStatLogTimely(t):e.ErrorLog.reportCacheData()}},e.GALog={gaLocalCacheData:[],sessionId:"",GA_TYPE:{TRACK:"track",LOGIN:"login",PAY:"pay"},GA_BASE_INFO:{PROJECT_ID:"20197",CLIENT_ID:"H5_2.0_weixin.weixin.0-hall20197.weixin.elsfkptnew",FRAMEWORK:"wxgame",LIB_VERSION:"1.0.1_0704-RELEASE",LIB_TYPE:"JavaScript"},addPrefix:function(e){var t="startsWith",r="proj_",n=e;try{if(null!=n&&"object"==typeof n)for(var i in n)null!=i&&!i[t]("sdk_")&&!i[t](r)&&(n[r+i]=n[i],delete n[i]);return n}catch(t){return e}},innerTrack:function(t,r,n){var i="SystemInfo",o="sessionId",a={proj_client_id:e[i].clientId,proj_game_id:e[i].gameId,proj_app_id:e[i].appId,proj_cloud_id:e[i].cloudId,sdk_c_framework:this.GA_BASE_INFO.FRAMEWORK,sdk_c_version:e[i].tywxVersion,sdk_pay_type:"1.0"===e[i].wxPayVersion?"wxapp.iap":"wxapp.iap.v2",sdk_session_id:this[o]?this[o]:this[o]=e.Util.createUUID()};n||(n={}),a=Object.assign(a,n),a=this.addPrefix(a),this.assembleGAData(t,r,a,!0)},track:function(e,t){t||(t={}),this.trackWithType(this.GA_TYPE.TRACK,e,t)},trackWithType:function(e,t,r){r||(r={}),r=this.addPrefix(r),this.assembleGAData(e,t,r,!1)},saveCache:function(e){var t="gaLocalCacheData";e&&(this[t]||(this[t]=[]),-1===this[t].indexOf(e)&&this[t].push(e),this[t].length>100&&this[t].shift())},deleteCache:function(e){var t="gaLocalCacheData";if(e&&this[t]){var r=this[t];e.forEach((function(e){r.indexOf(e)>-1&&r.splice(r.indexOf(e),1)}))}},getCacheWithLimitCount:function(e,t){if(e){for(var r=[],n=Array.from(e),i=n.length>t?t:n.length,o=0;o<i;o++)r.push(n[o]);return r}},processArray2String:function(e){if(e){var t="";return e.forEach((function(e){t+=e+"\n"})),t}},assembleGAData:function(t,r,n,i){var o="UserInfo",a="SystemInfo",s="GA_BASE_INFO",c={phone_model:e[o].model,os_name:e[o].platform,api_version:e[o].sdkVersion,os_version:e[o].system,network:e.StateInfo.networkType,uuid:e.Util.createUUID(),sdk_channel_version:e[o].wechatType,sdk_channel_app_id:e[a].wxAppId,sdk_device_level:e[o].benchmarkLevel,sdk_channel_language:e[o].language};n=Object.assign(n,c);var d={project_id:i?this[s].PROJECT_ID:e[a].gameId,client_id:i?this[s].CLIENT_ID:e[a].clientId,event_time:(new Date).getTime(),event:r,type:t,properties:n,device_id:e.Util.getLocalUUID(),user_id:e[o].userId?e[o].userId:"0",lib:{lib_version:this[s].LIB_VERSION,lib_type:this[s].LIB_TYPE}};this.saveCache(JSON.stringify(d));var l=this.getCacheWithLimitCount(this.gaLocalCacheData,10);this.reportGALog(l)},reportGALog:function(t){var r="reportCacheData",n=this.processArray2String(t);if(t&&t.length>0){var i={url:e.SystemInfo.gaLogServer,postData:n,header:{"content-type":"application/x-www-form-urlencoded"}};e.LOGE("GA_REPORT_LOG:",""+n),e.LOGD("BILOG","reportGaLog:"+n),e.HttpUtil.httpLimitPost(e.HttpUtil.httpLimitType.biLimit,i,(function(n){e.GALog.deleteCache(t),e.GALog[r]()}),null)}else this[r]()},reportCacheData:function(){var t=this.getCacheWithLimitCount(this.gaLocalCacheData,10);t&&t.length>0?this.reportGALog(t):e.BiLog.reportCacheData()}},e.HttpUtil={httpLimitType:{biLimit:"BI_LIMIT"},httpLimitState:{},httpLimitPost:function(t,r,n,i){var o="httpLimitState",a=!1,s="statusCode",c="ty.HttpUtil.httpPost";(this[o].hasOwnProperty(t)&&"boolean"==typeof this[o][t]?this[o][t]:a)?i&&i("limit"):(this[o][t]=!0,wx.request({url:r.url,data:r.postData,header:r.header,method:"POST",dataType:"json",success:function(r){e.HttpUtil[o][t]=a,200==r[s]?(e.LOGD(c,"post success! "),n&&n(r.data)):(e.LOGD(c,"statusCode:"+r[s]),i&&i(r))},fail:function(n){e.HttpUtil[o][t]=a,e.LOGD(c,"post error! "+r.url),i&&i(n)}}))},httpPostJson:function(t,r,n){var i="statusCode",o="ty.HttpUtil.httpPost";try{e.IsWechatPlatform()&&wx.request({url:t.url,data:t.postData,header:t.header,method:"POST",dataType:"json",success:function(t){200==t[i]&&t.data?r&&r(t.data):(e.LOGD(o,"statusCode:"+t[i]),n&&n(t))},fail:function(r){e.LOGD(o,"post error! "+t.url),n&&n(r)}})}catch(t){e.LOGE("error:","tywx.HttpUtil.httpPost——"+JSON.stringify(t))}},httpGet:function(t,r,n){var i="ty.HttpUtil.httpGet",o="statusCode";e.IsWechatPlatform()&&(e.LOGD(i,"url:"+t.url),wx.request({url:t.url,method:"GET",success:function(t){200==t[o]?(e.LOGD(i,"res:"+JSON.stringify(t.data)),r&&r(t.data)):e.LOGD(i,"statusCode:"+t[o])},fail:function(r){e.LOGD(i,"post error! "+t.url),n&&n(r)}}))}},e.NotificationCenter={events:{},listen:function(e,t,r){this.events[e]=this.events[e]||[],this.events[e].push({scope:r||this,handler:t})},ignore:function(e,t,r){r=r||this;var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e.scope!=r||e.handler!=t})))},ignoreScope:function(t){for(var r in this.events){var n=this.events[r];n&&(this.events[r]=n.filter((function(n){return n.scope!=t||(e.LOGD("tywx.NotificationCenter","ty.NotificationCenter : remove listener by Scope: "+r),!1)})))}},trigger:function(t,r){e.LOGD("EventTrigger",t);var n=this.events[t];if(n)for(var i,o=0;o<n.length;o++)(i=n[o]).handler.call(i.scope,r)}},e.TuyooSDK={SESSION_KEY:"TU_SESSION_STORAGE",ipLocInfo:"",CheckBind:function(t,r){if(""!=t&&0!=t&&null!=t){var n=e.SystemInfo.loginUrl;n=n+"open/v5/user/checkUserIsBindMobile?userId="+t+"&osName="+e.UserInfo.platform+"&original_deviceid="+e.Util.getLocalUUID(),wx.request({url:n,success:function(e){var t=e.data.result;t?r&&r(t.code,t.info):r&&r(-1,e.data)},fail:function(e){r&&r(-1,e)}})}else e.LOGE("CheckBind:"," userid 不能为空！")},ThirdBindSns:function(t,r,n,i,o){var a="innerTrack",s="GALog",c="TRACK",d="GA_TYPE",l="IsNull",f="Util",u="please check phoneNumber,messageCode,userId,password",_="sdk_error_msg",h="sdk_c_bind_fail",p="手机格式不正确",I="SystemInfo",g="sdk_error_code",S={sdk_bind_type:"phone_sms_code"};if(e[s][a](e[s][d][c],"sdk_c_bind_start",S),e[f][l](t)||e[f][l](r)||e[f][l](n)||e[f][l](i))return o&&o(-1,u),S[_]=u,void e[s][a](e[s][d][c],h,S);if(!e[f].CheckPhoneNumber(t))return o&&o(-1,p),S[_]=p,void e[s][a](e[s][d][c],h,S);var m={imei:"null",appId:e[I].appId,clientId:e[I].clientId,mobile:t,vcode:r,userId:n,pdtest:i,osName:e.UserInfo.platform,original_deviceid:e[f].getLocalUUID()},v={url:e[I].loginUrl+"open/v4/user/bindUserByMobile",postData:m};e.HttpUtil.httpPostJson(v,(function(t){var r=t.result;0===r.code?(o&&o(r.code,r.info),e[s][a](e[s][d][c],"sdk_c_bind_succ",S)):(o&&o(r.code,r.info),S[g]=r.code,S[_]=r.info,e[s][a](e[s][d][c],h,S))}),(function(t){o&&o(-2,"绑定失败"),S[g]="-2",S[_]=JSON.stringify(t),e[s][a](e[s][d][c],h,S)}))},ThirdSmsSend:function(t,r){var n="innerTrack",i="GALog",o="TRACK",a="GA_TYPE",s="手机号不能为空",c="sdk_error_code",d="sdk_error_msg",l="sdk_c_send_sms_code_fail",f="手机格式不正确",u="SystemInfo",_={};if(e[i][n](e[i][a][o],"sdk_c_send_sms_code_start",_),e.Util.IsNull(t))return r&&r(-1,s),_[c]="-1",_[d]=s,void e[i][n](e[i][a][o],l,_);if(!e.Util.CheckPhoneNumber(t))return r&&r(-1,f),_[c]="-1",_[d]=f,void e[i][n](e[i][a][o],l,_);var h=e[u].loginUrl+"open/v4/user/sendSmsVerifyCode",p={url:h=h+"?imei=null&appId="+e[u].appId+"&clientId="+e[u].clientId+"&mobile="+t+"&type=3&osName="+e.UserInfo.platform+"&original_deviceid="+e.Util.getLocalUUID()};e.HttpUtil.httpGet(p,(function(t){var s=t.result;0===s.code?(r&&r(s.code,s.info),e[i][n](e[i][a][o],"sdk_c_send_sms_code_succ",_)):(r&&r(s.code,s.info),_[c]=s.code,_[d]=s.info,e[i][n](e[i][a][o],l,_))}),(function(t){r&&r(-2,"send fail"),_[c]="-2",_[d]=JSON.stringify(t),e[i][n](e[i][a][o],l,_)}))},login:function(){e.TuyooSDK.wechatLogin()},wechatLogin:function(){var t="innerTrack",r="GALog",n="LOGIN",i="GA_TYPE",o="GAEventType",a="stringify",s="NotificationCenter";if(e.IsWechatPlatform()){var c={sdk_login_channel_type:"wxapp",sdk_login_track_id:e.Util.createUUID()};e[r][t](e[r][i][n],e[o].SDK_LOGIN_START,c),e[r][t](e[r][i][n],e[o].SDK_LOGIN_BY_CHANNEL_START,c),wx.login({success:function(d){e.LOGD(null,"wx login success, params:"+JSON[a](d)),c.sdk_event_tips=d.code,e[r][t](e[r][i][n],e[o].SDK_LOGIN_BY_CHANNEL_SUCC,c),d.code&&(e.TuyooSDK.loginTuyooWithCode(d.code,{},c),e[s].trigger(e.EventType.WEIXIN_LOGIN_SUCCESS))},fail:function(d){c.sdk_channel_error_msg=JSON[a](d),e[r][t](e[r][i][n],e[o].SDK_LOGIN_BY_CHANNEL_FAIL,c),e.LOGD(null,"wx login fail, params:"+JSON[a](d)),e[s].trigger(e.EventType.WEIXIN_LOGIN_FAIL)},complete:function(e){}})}},loginTuyooWithCode:function(t,r,n){var i="SystemInfo",o="getLocalUUID",a="UserInfo",s="unionId",c="nickName",d="avatarUrl",l="signature",f="encryptedData",u="platform",_="extraParams",h="stringify",p="innerTrack",I="GALog",g="LOGIN",S="GA_TYPE",m="GAEventType",v="sdk_error_code",y="sdk_error_msg",A="SDK_LOGIN_BY_SDKSERVER_FAIL",T="handleLoginFail",E="TuyooSDK";if(e.IsWechatPlatform()){var C=(r=r||{}).gender||0,L={appId:e[i].appId,wxAppId:e[i].wxAppId,clientId:e[i].clientId,snsId:"wxapp:"+t,uuid:e.Util[o](),gender:C,scene_id:e[a].scene_id||"",scene_param:e[a].scene_param||"",invite_id:e[a].invite_id||0,original_deviceid:e.Util[o]()};if(r[s]&&(L[s]=r[s]),r[c]&&(L[c]=r[c]),r[d]&&(L[d]=r[d]),e[a][l]&&(L[l]=e[a][l]),e[a][f]&&(L[f]=e[a][f]),e[a].iv&&(L.iv=e[a].iv),"Default"!=e[a][u])L.osName=e[a][u];else{var w=this.getSystemInfoSync();L.osName=w?w[u]:""}L[_]=JSON[h](e[a][_]),n=n||{},e[I][p](e[I][S][g],e[m].SDK_LOGIN_BY_SDKSERVER_START,n),wx.request({url:e[i].loginUrl+"open/v6/user/LoginBySnsIdNoVerify",header:{"content-type":"application/x-www-form-urlencoded"},data:L,method:"POST",success:function(t){var r=t.data;if(r.error)return n[v]=r.error.code,n[y]=JSON[h](r.error),e[I][p](e[I][S][g],e[m][A],n),void e[E][T](n,t);var i=r.result;if(!i.userId)return n[v]=i.code,n[y]=JSON[h](i),e[I][p](e[I][S][g],e[m][A],n),void e[E][T](n,t);e[I][p](e[I][S][g],e[m].SDK_LOGIN_BY_SDKSERVER_SUCC,n),e[E].handleLoginSucc(n,t)},fail:function(t){n[y]=JSON[h](t),e[I][p](e[I][S][g],e[m][A],n),e[E][T](n,t)},complete:function(e){}})}},handleLoginFail:function(t,r){var n="SDK_LOGIN_FAIL";e.GALog.innerTrack(e.GALog.GA_TYPE.LOGIN,e.GAEventType[n],t),e.NotificationCenter.trigger(e.EventType[n]),e.LOGE("TUYOO_SDK_LOGIN_FAIL",r?JSON.stringify(r):"error")},handleLoginSucc:function(t,r){var n="userId",i="UserInfo",o="authorCode",a="wxgame_session_key",s="showQuery",c="sourceCode";if(r.data&&r.data.result){var d=r.data.result;e[i][n]=d[n],e[i].userName=d.userName,e[i].userPic=d.purl,e[i][o]=d[o],e[i][a]=d[a]||"",e.LOGE("TUYOO_SDK_LOGIN_SUCCESS","userId:"+e[i][n]),e.Util.setItemToLocalStorage(e.TuyooSDK.SESSION_KEY,d.token),e.showScene&&e[s]&&e[s][c]&&e.BiLog.clickStat(e.clickStatEventType.clickStatEventTypeUserFrom,[e.showScene,e[s].inviteCode,e[s][c],e[s].imageType,"GameStart"]),e.GALog.innerTrack(e.GALog.GA_TYPE.LOGIN,e.GAEventType.SDK_LOGIN_SUCC,t),e.NotificationCenter.trigger(e.EventType.SDK_LOGIN_SUCCESS,d)}},loginByCodeAndUnionId:function(t,r){if(t&&e.IsWechatPlatform()){var n={sdk_login_channel_type:"wxapp",sdk_login_track_id:e.Util.createUUID(),sdk_event_tips:t};e.GALog.innerTrack(e.GALog.GA_TYPE.LOGIN,e.GAEventType.SDK_LOGIN_START,n),e.TuyooSDK.loginTuyooWithCode(t,{unionId:r},n)}},loginByWXInfo:function(t,r){var n="wxOpenId",i="error",o="innerTrack",a="GALog",s="LOGIN",c="GA_TYPE",d="GAEventType",l="SystemInfo",f="getLocalUUID",u="UserInfo",_="platform",h="extraParams",p="stringify",I="sdk_error_code",g="sdk_error_msg",S="SDK_LOGIN_BY_SDKSERVER_FAIL",m="handleLoginFail",v="TuyooSDK";if(t&&t[n]){var y={sdk_login_channel_type:"threewxapp",sdk_event_tips:t[n],sdk_login_track_id:e.Util.createUUID()};e[a][o](e[a][c][s],e[d].SDK_LOGIN_START,y);var A=r||{},T={appId:e[l].appId,clientId:e[l].clientId,loginFlag:0,imei:"null",uuid:e.Util[f](),snsId:"threewxapp:"+t[n],wxAppId:e[l].wxAppId,unionId:t.unionId||"",session_key:t.session_key||"",nickName:A.nickName||"",avatarUrl:A.avatarUrl||"",gender:A.gender||"0",scene_id:e[u].scene_id,invite_id:e[u].invite_id,scene_param:e[u].scene_param,original_deviceid:e.Util[f]()};if("Default"!=e[u][_])T.osName=e[u][_];else{var E=this.getSystemInfoSync();T.osName=E?E[_]:""}T[h]=JSON[p](e[u][h]),e[a][o](e[a][c][s],e[d].SDK_LOGIN_BY_SDKSERVER_START,y);var C=e[l].loginUrl;wx.request({url:C+"open/v6/user/LoginBySnsIdNoVerify",header:{"content-type":"application/x-www-form-urlencoded"},data:T,method:"POST",success:function(t){var r=t.data;if(r[i])return y[I]=r[i].code,y[g]=JSON[p](r[i]),e[a][o](e[a][c][s],e[d][S],y),void e[v][m](y,t);var n=r.result;if(!n.userId)return y[I]=n.code,y[g]=JSON[p](n),e[a][o](e[a][c][s],e[d][S],y),void e[v][m](y,t);e[a][o](e[a][c][s],e[d].SDK_LOGIN_BY_SDKSERVER_SUCC,y),e[v].handleLoginSucc(y,t)},fail:function(t){y[g]=JSON[p](t),e[a][o](e[a][c][s],e[d][S],y),e[v][m](y,t)},complete:function(e){}})}},setWxEncryptedData:function(t,r){var n="UserInfo",i="SystemInfo",o="trigger",a="NotificationCenter",s="EventType",c="SET_WX_SENSITIVE_DATA_FAIL";if(e[n].userId&&t&&r){var d={userId:e[n].userId,wxAppId:e[i].wxAppId,encryptedData:t,iv:r,osName:e[n].platform,original_deviceid:e.Util.getLocalUUID()};wx.request({url:e[i].loginUrl+"open/v6/user/setWxEncryptedData",header:{"content-type":"application/x-www-form-urlencoded"},data:d,method:"POST",success:function(t){var r=t.data.result;r&&0==r.code?e[a][o](e[s].SET_WX_SENSITIVE_DATA_SUCCESS):e[a][o](e[s][c])},fail:function(t){e[a][o](e[s][c])},complete:function(e){}})}},setThreeWxEncryptedData:function(t,r,n){var i="SystemInfo",o="trigger",a="NotificationCenter",s="EventType",c="SET_WX_SENSITIVE_DATA_FAIL";if(t){null!=r&&void 0!==r||(r="");var d={wxAppId:e[i].wxAppId,wxOpenId:t,unionId:r,session_key:n||"",osName:e.UserInfo.platform,original_deviceid:e.Util.getLocalUUID()},l=e[i].loginUrl;wx.request({url:l+"open/v6/user/setThreeWxEncryptedData",header:{"content-type":"application/x-www-form-urlencoded"},data:d,method:"POST",success:function(t){var r=t.data.result;r&&0==r.code?e[a][o](e[s].SET_WX_SENSITIVE_DATA_SUCCESS):e[a][o](e[s][c])},fail:function(t){e[a][o](e[s][c])},complete:function(e){}})}},getSystemInfoSync:function(){if(!e.IsWechatPlatform())return{};const t=wx.getSystemInfoSync();return this.handleWXSystemInfo(t)},getSystemInfo:function(){e.IsWechatPlatform()&&wx.getSystemInfo({success:function(t){e.TuyooSDK.handleWXSystemInfo(t)},fail:function(){},complete:function(){}})},handleWXSystemInfo:function(t){var r="UserInfo",n="platform",i="benchmarkLevel";if(!t)return{};var o,a=t.model.indexOf("iPhone")>=0,s=t.windowHeight;return o=a?812==s?2:736==s?4:1:3,e[r].systemType=o,e[r].wechatType=t.version,e[r].model=t.model,e[r].system=t.system,e[r].sdkVersion=t.SDKVersion,e[r][n]=t[n],e[r].language=t.language,e[r][i]=t[i],e[r].extraParams.osName=t[n],t},setWxUserInfo:function(t){var r="UserInfo",n="trigger",i="NotificationCenter",o="EventType",a="SET_WX_USER_INFO_FAIL";if(e[r].userId&&t){var s={userId:e[r].userId.toString(),province:t.province||"",nickName:t.nickName||"",avatarUrl:t.avatarUrl||"",gender:t.gender||0,city:t.city||"",country:t.country||"",language:t.language||"",osName:e[r].platform,original_deviceid:e.Util.getLocalUUID()},c=e.SystemInfo.loginUrl;wx.request({url:c+"open/v6/user/setWxUserInfo",header:{"content-type":"application/x-www-form-urlencoded"},data:s,method:"POST",success:function(t){var r=t.data.result;r&&0==r.code?e[i][n](e[o].SET_WX_USER_INFO_SUCCESS):e[i][n](e[o][a])},fail:function(t){e[i][n](e[o][a])},complete:function(e){}})}},wechatAuthorize:function(){var t="scope.userInfo",r="clickStat",n="clickStatEventType",i="trigger",o="NotificationCenter",a="START_AUTHORIZATION_SUCCESS",s="EventType";e.IsWechatPlatform()&&wx.getSetting({success:function(c){c.authSetting[t]?e[o][i](e[s][a]):(e.BiLog[r](e[n].clickStatEventTypeAuthorizationStart,[]),wx.authorize({scope:t,success:function(){e.BiLog[r](e[n].clickStatEventTypeAuthorizationSuccess,[]),e[o][i](e[s][a])},fail:function(){e.BiLog[r](e[n].clickStatEventTypeAuthorizationFailed,[]),e[o][i](e[s].START_AUTHORIZATION_FAILED)},complete:function(){}}))}})},wechatAuthorizeForUserInfo:function(t,r,n){var i="clickStat",o="clickStatEventType",a="trigger",s="NotificationCenter",c="EventType",d="START_AUTHORIZATION_SUCCESS",l="getUserInfo",f="userInfo",u="setWxUserInfo",_="wxUserInfo";try{if(!e.IsWechatPlatform())return;wx.getSetting({success:function(h){if(h.authSetting["scope.userInfo"])e[s][a](e[c][d]),wx[l]({success:function(t){t&&t[f]&&(e.TuyooSDK[u](t[f]),e.UserInfo[_]=t[f])},complete:function(){r&&r()}});else{e.BiLog[i](e[o].clickStatEventTypeAuthorizationStart,[]);var p=wx.createUserInfoButton(t);p.onTap((function(t){-1!=t.errMsg.indexOf("fail")?(e.BiLog[i](e[o].clickStatEventTypeAuthorizationFailed,[]),e[s][a](e[c].START_AUTHORIZATION_FAILED),n&&n()):(e.BiLog[i](e[o].clickStatEventTypeAuthorizationSuccess,[]),e[s][a](e[c][d]),wx[l]({success:function(t){t&&t[f]&&(e.TuyooSDK[u](t[f]),e.UserInfo[_]=t[f])},complete:function(e){r&&r()}}),p.destroy())}))}}})}catch(t){e.LOGE("error:","tywx.TuyooSDK.wechatAuthorizeForUserInfo——"+JSON.stringify(t))}},requestIPLocInfo:function(){var t=function(){e.TuyooSDK.requestIPLocInfo()};wx.request({url:"https://iploc.ywdier.com/api/iploc5/search/city",success:function(r){200==r.statusCode?r.data&&r.data.loc&&r.data.ip&&(e.TuyooSDK.ipLocInfo=r.data):setTimeout(t,2e3)},fail:function(e){setTimeout(t,1e4)}})}},e.wxOnshowAction=function(t){var r="stringify",n="UserInfo",i="inviteCode",o="sourceCode",a="clickStat",s="BiLog",c="clickStatEventTypeUserFrom",d="clickStatEventType",l="AdManager",f="onForeGround";if(e.IsWechatPlatform()){e.LOGE("","+++++++++++++++++onShow+++++++++++++++++"+JSON[r](t));var u=t.scene,_=t.query;e.showScene=u,e.showQuery=_,e[n].scene_id=u,e[n].invite_id=_[i]||0,e.NotificationCenter.trigger(e.EventType.GAME_SHOW,t);var h="";_&&_[o]?(1088==u?e[s][a](e[d][c],[u,_[i],_[o],_.imageType,_.entryType]):e[s][a](e[d][c],[u,_[i],_[o],_.imageType,"CardActive",_.template_type,_.fun_type]),h=e.b64(JSON[r](_))):e.Util.isSceneQrCode(u)&&t.hasOwnProperty("path")?((h=t.path).replace(".html",""),h=decodeURIComponent(h),e[s][a](e[d][c],[u,h])):(h=e.b64(JSON[r](_)),e[s][a](e[d][c],[u,h])),e[n].scene_param=h,e.TuyooSDK.getSystemInfo(),e.PropagateInterface._doHttpGetShareConfig(),e.TuyooSDK.requestIPLocInfo(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),e[l]&&e[l][f]&&e[l][f]()}},e.WechatNetworkInit=function(){var t="hasOwnProperty",r="isConnected",n="networkConnected",i="StateInfo",o="networkType";if(e.IsWechatPlatform()){var a=function(a){a[t](r)?e[i][n]=a[r]:a[t]("errMsg")?e[i][n]="getNetworkType:ok"==a.errMsg:e[i][n]="none"!=a[o],e[i][o]=a[o]};wx.getNetworkType({success:a}),wx.onNetworkStatusChange(a),wx.onError((function(t){var r=new Date,n="userId:"+e.UserInfo.userId+"time:"+r.toDateString()+" "+r.toTimeString()+";"+t.message;e.ErrorLog.uploadLogTimely(n)}))}},e.WechatNetworkInit(),e.PropagateInterface={_cachedShareConfig:void 0,_rawConfigInfo:void 0,_connectConfigInfo:{},getShareConfigInfoAutoWeight:function(){return this._shuffleByWeights()},_doHttpGetShareConfig:function(){var t="SystemInfo",r={},n=(new Date).getTime();r.act="api.getShareConfig",r.time=n,r.game_mark=e[t].cloudId+"-"+e[t].gameId;var i=this.getConfigSignStr(r),o=[];for(var a in r)o.push(a+"="+r[a]);o.push("sign="+i);var s=e[t].shareManagerUrl+"?"+o.join("&"),c=this;e.HttpUtil.httpGet({url:s},(function(e){e.retmsg&&(c._rawConfigInfo=e.retmsg,c.processRawShareConfigInfo(),c.connectRawShareConfigInfo())}),(function(t){e.NotificationCenter.trigger(e.EventType.GET_SHARE_CONFIG_FAIL,t),setTimeout((function(){c._doHttpGetShareConfig()}),1e4)}))},_shuffleByWeights:function(){var e="_cachedShareConfig",t="length",r={};for(var n in this[e])if("shareExt"!=n){var i=this[e][n];if(0==i[t])r[n]={};else if(1==i[t])r[n]=i[0];else for(var o=i.reduce((function(e,t){return e+t.weight}),0),a=Math.random()*o,s=0;s<i[t];s++)if((a-=i[s].weight)<=0){r[n]=i[s];break}}return r},getUserFeatureInfo:function(){var t="SystemInfo",r="NotificationCenter",n={},i=(new Date).getTime();n.act="api.getUserFeature",n.cloud_id=e[t].cloudId,n.game_id=e[t].gameId,n.user_id=e.UserInfo.userId,n.time=i;var o=this.getConfigSignStr(n),a=[];for(var s in n)a.push(s+"="+n[s]);a.push("sign="+o);var c=e[t].shareManagerUrl+"?"+a.join("&");e.HttpUtil.httpGet({url:c},(function(t){e[r].trigger(e.EventType.GET_USER_FEATURE_SUCCESS,t)}),(function(t){e[r].trigger(e.EventType.GET_USER_FEATURE_FAIL,t)}))},processRawShareConfigInfo:function(){var t="_cachedShareConfig",r="_rawConfigInfo",n=this;if(this[t]={},this[r]){for(var i=Object.keys(this[r]),o=0,a=i.length;o<a;o++){var s=this[r][i[o]],c=s.length;this[t][i[o]]=[],0<c&&s.forEach((function(e){n[t][i[o]].push(e)}))}e.NotificationCenter.trigger(e.EventType.GET_SHARE_CONFIG_SUCCESS,this._shuffleByWeights())}},connectRawShareConfigInfo:function(){var e="_rawConfigInfo",t=this;for(var r in this[e]){var n=this[e][r];Array.isArray(n)&&0!==n.length&&0!=n.length&&n.forEach((function(e){var r=e.shareSchemeId.toString(),n={imageUrlId:e.sharePicId||"",template_type:e.template_type};t._connectConfigInfo[r]=n}))}},getConfigSignStr:function(t){for(var r=Object.keys(t).sort(),n="",i=0;i<r.length;i++){var o=r[i];"act"!=o&&"sign"!=o&&(n+=o+"="+t[o])}return e.hex_md5("market.tuyoo.com-api-"+n+"-market.tuyoo-api")||""}},e.ShareInterface={OnShareAppMessageInfo:null,setOnShareAppMessageInfoWithSharePoint:function(t){var r="PropagateInterface";if(e[r]._cachedShareConfig){var n=e[r]._shuffleByWeights();if(n&&n[t]){var i=n[t];this.OnShareAppMessageInfo={title:i.shareContent,imageUrl:i.sharePicUrl,sharePointId:i.sharePointId,shareSchemeId:i.shareSchemeId}}}},setOnShareAppMessageInfo:function(e,t,r,n){this.OnShareAppMessageInfo={title:e,imageUrl:t,sharePointId:r,shareSchemeId:n}},getOnShareAppMessageInfo:function(){return this.OnShareAppMessageInfo},getRandomOnShareAppMessageInfo:function(){var t="_cachedShareConfig",r="PropagateInterface",n="length",i=[];for(var o in e[r][t]){var a=e[r][t][o];a[n]&&!a[0].template_type&&i.push(o)}if(i&&i[n]>0){var s=Math.floor(1e4*Math.random())%i[n],c=i[s],d=e[r][t][c];if(d&&d[n]>0)return{title:d[s=Math.floor(1e4*Math.random())%d[n]].shareContent,imageUrl:d[s].sharePicUrl,sharePointId:d[s].sharePointId,shareSchemeId:d[s].shareSchemeId}}return null},share:function(t,r,n,i,o,a,s){var c="clickStatEventTypeUserShare",d="clickStatEventType",l="share";try{if(e.IsWechatPlatform()){var f=e.PropagateInterface._connectConfigInfo[i],u=f?f.template_type:0,_=f?f.imageUrlId:"";e.BiLog.clickStat(e[d][c],[n,1,i,u,l]),wx.shareAppMessage({title:t,imageUrl:r,imageUrlId:_||"",query:"inviteCode="+e.UserInfo.userId+"&sourceCode="+n+"&inviteName="+e.UserInfo.userName+"&imageType="+i+"&template_type="+u+"&fun_type="+l+"&extraInfo="+(s||""),success:function(t){o&&o(t),e.BiLog.clickStat(e[d][c],[n,2,i,u,l])},fail:function(e){a&&a(e)},complete:function(){}})}}catch(t){e.LOGE("error:","tywx.ShareInterface.share——"+JSON.stringify(t))}},activityShare:function(t,r,n,i){var o="template_type",a="activity_id",s="updateShareMenu",c=!0,d="shareContent",l="sharePicUrl",f="sharePointId",u="shareSchemeId",_="activityShare",h="clickStatEventTypeUserShare",p="clickStatEventType",I="ShareInterface";try{if(e.IsWechatPlatform()){var g=t[o];g&&t[a]?wx[s]({withShareTicket:c,isUpdatableMessage:c,activityId:t[a],templateInfo:{parameterList:[{name:"member_count",value:t.user_num_lower.toString()},{name:"room_limit",value:t.user_num_upper.toString()}]},success:function(a){wx.shareAppMessage({title:t[d],imageUrl:t[l],imageUrlId:t.sharePicId||"",query:"inviteCode="+e.UserInfo.userId+"&sourceCode="+t[f]+"&inviteName="+e.UserInfo.userName+"&imageType="+t[u]+"&template_type="+t[o]+"&fun_type="+_+"&extraInfo="+(i||""),success:function(n){r&&r(n),e.BiLog.clickStat(e[p][h],[t[f],2,t[u],g,_])},fail:function(e){n&&n(e)}}),e.BiLog.clickStat(e[p][h],[t[f],1,t[u],g,_])},fail:function(o){e[I].share(t[d],t[l],t[f],t[u],r,n,i)},complete:function(){setTimeout((function(){wx[s]({withShareTicket:c,isUpdatableMessage:!1,activityId:"",templateInfo:{}})}),1e3)}}):e[I].share(t[d],t[l],t[f],t[u],r,n,i)}}catch(t){e.LOGE("error:","tywx.ShareInterface.activityShare——"+JSON.stringify(t))}}},e.onShareAppMessageInit=function(){var t="onShareAppMessage",r="getOnShareAppMessageInfo",n="ShareInterface",i="getRandomOnShareAppMessageInfo",o="_connectConfigInfo",a="PropagateInterface",s="shareSchemeId",c="template_type",d="imageUrlId",l="clickStat",f="clickStatEventTypeUserShare",u="clickStatEventType",_="sharePointId",h="inviteCode=",p="UserInfo",I="&sourceCode=",g="&inviteName=",S="&imageType=",m="&template_type=",v="&fun_type=",y="onShareTimeline";e.IsWechatPlatform()&&(wx[t]((function(y){var A=e[n][r]();null==A&&(A=e[n][i]()),A=A||{};var T=e[a][o][A[s]],E=T?T[c]:0,C=T?T[d]:"";return e.BiLog[l](e[u][f],[A[_],1,A[s],E,t]),{title:A.title||"",imageUrl:A.imageUrl||"",imageUrlId:C||"",query:h+e[p].userId+I+A[_]+g+e[p].userName+S+A[s]+m+E+v+t,success:function(r,n){e.BiLog[l](e[u][f],[A[_],2,A[s],E,t])},fail:function(){},complete:function(){}}})),wx[y]&&wx[y]((function(t){var A=e[n][r]();null==A&&(A=e[n][i]()),A=A||{};var T=e[a][o][A[s]],E=T?T[c]:0,C=T?T[d]:"";return e.BiLog[l](e[u][f],[A[_],1,A[s],E,y]),{title:A.title||"",imageUrl:A.imageUrl||"",imageUrlId:C||"",query:h+e[p].userId+I+A[_]+g+e[p].userName+S+A[s]+m+E+v+y}})))},e.AdManager={retryCrossTimes:3,retryNewAdTimes:3,iconTimer:0,newIconTimer:0,AnimType:{STATIC:1,SHAKE:2,FRAME:3},adNodeList:[],newAdNodeList:[],newAdPointInfoList:[],allAdInfoList:[],allNewAdInfoDict:{},rawAdInfoList:void 0,rawNewAdInfoDict:void 0,showAd:function(t,r){var n="AdManager",i=new e[n].adNodeClass;i.adInfoList=JSON.parse(JSON.stringify(e[n].allAdInfoList)),i.adType=1,i.adTag=r||"",null==t&&(t={x:0,y:0}),i.createAdNode(t),e[n].adNodeList.push(i)},showNewAd:function(t,r,n){var i="AdManager",o="allNewAdInfoDict",a="adInfoList",s=new e[i].adNodeClass;null!=r&&"string"==typeof r&&null!=e[i][o][r]&&(s[a]=JSON.parse(JSON.stringify(e[i][o][r])),e[i].newAdPointInfoList=s[a],s.adType=3,s.adTag=n||"",null==t&&(t={x:0,y:0}),s.createAdNode(t),e[i].newAdNodeList.push(s))},getAdNodeList:function(){return this.adNodeList},getNewAdNodeList:function(){return this.newAdNodeList},getAdNodeByTag:function(e){var t="adNodeList";if(!e)return null;for(var r in this[t])if(this[t][r].adTag.toString()==e.toString())return this[t][r];return null},getNewAdNodeByTag:function(e){var t="newAdNodeList";if(!e)return null;for(var r in this[t])if(this[t][r].adTag.toString()==e.toString())return this[t][r];return null},getAdInfoList:function(){return this.allAdInfoList},getNewAdInfoDict:function(){return this.allNewAdInfoDict},adNodeClass:function(){this.adType=0,this.adIconBtn=null,this.currentAdInfo=null,this.currentWebPage=null,this.adInfoList=[],this.adTag=""},adNodeObj:{createAdNode:function(e){var t="adIconBtn";if(this.genRandomFirstAdInfo(),this.currentAdInfo)if(this[t])this[t].active=!0;else{var r=this;cc.loader.loadRes("prefabs/adNode",(function(n,i){var o=cc.instantiate(i),a=e||{x:0,y:0};o.position=cc.p(a.x,a.y),r[t]=o,cc.game.addPersistRootNode(o),r.adIconNode(),r[t].getChildByName("adButton").on("click",(function(){r.onClickAdIconBtn()}))}))}},genRandomFirstAdInfo:function(){var e="adInfoList",t="weight",r=this;if(0!=this[e].length){var n=[{weight:0,id:"000"}];for(var i in this[e]){var o={weight:parseInt(r[e][i].icon_weight),id:r[e][i].icon_id};n.push(o)}n.sort((function(e,r){return e[t]>r[t]}));var a=0;n.forEach((function(e){a+=e[t]}));var s=parseInt(1e4*Math.random())%(a+1),c=0,d=0;for(i=0;i<n.length-1;i++)if((c+=n[i][t])<s&&c+n[i+1][t]>=s){d=i+1;break}var l=n[d];this[e].forEach((function(e){e.icon_id==l.id&&(r.currentAdInfo=e)}))}},genRandomSecondAdInfo:function(){var e="weight",t=this,r=this.currentAdInfo.webpages;if(void 0!==r&&0!=r.length){var n=[{weight:0,id:"000"}];for(var i in r){var o={weight:parseInt(r[i].webpage_weight),id:r[i].config_id};n.push(o)}n.sort((function(t,r){return t[e]>r[e]}));var a=0;n.forEach((function(t){a+=t[e]}));var s=parseInt(1e4*Math.random())%(a+1),c=0,d=0;for(i=0;i<n.length-1;i++)if((c+=n[i][e])<s&&c+n[i+1][e]>=s){d=i+1;break}var l=n[d];r.forEach((function(e){e.config_id==l.id&&(t.currentWebPage=e)}))}},adIconNode:function(){var t="currentAdInfo",r="adIconBtn",n="getChildByName",i="stopAllActions",o="removeComponent",a="Animation",s="AnimType",c="AdManager",d="loader",l="icon_url",f="spriteFrame",u="getComponent",_="SpriteFrame",h="width",p="height",I="setContentSize",g="size",S="rotateBy",m="anim_frame",v="getContent";if(this[t]&&this[r]){var y=this[t].icon_type,A=this,T=this[r][n]("adIcon"),E=this[r][n]("adButton");switch(T[i](),T[o](cc[a]),T.setRotation(0),y){case e[c][s].STATIC:cc[d].load({url:A[t][l][0]},(function(e,t){e||(T[u](cc.Sprite)[f]=new cc[_](t),t&&t[h]&&t[p]&&(T[I](cc[g](t[h],t[p])),E[I](cc[g](t[h],t[p]))))}));break;case e[c][s].SHAKE:cc[d].load({url:A[t][l][0]},(function(e,t){T[u](cc.Sprite)[f]=new cc[_](t),t&&t[h]&&t[p]&&(T[I](cc[g](t[h],t[p])),E[I](cc[g](t[h],t[p]))),T.anchorX=.5,T.anchorY=.5;var r=cc[S](.06,-20),n=cc[S](.12,40),i=cc[S](.12,-40),o=cc[S](.06,20),a=cc.delayTime(1);T.runAction(cc.repeatForever(cc.sequence(r,cc.repeat(cc.sequence(n,i),2),o,a)))}));break;case e[c][s].FRAME:var C=[],L=function(){T[i](),T[o](cc[a]);var e=C[0].getTexture();e&&e[h]&&e[p]&&(T[I](cc[g](e[h],e[p])),E[I](cc[g](e[h],e[p])));var r=A[t].time_interval,n=r&&r>0?1e3/r:10,s=T.addComponent(cc[a]),c=cc.AnimationClip.createWithSpriteFrames(C,n);c.name=m,c.wrapMode=cc.WrapMode.Loop,s.addClip(c),s.play(m)};cc[d].load(A[t][l],(function(e,r){if(e)for(var n=0;n<e.length;n++)cc.log("Error url ["+e[n]+"]: "+r.getError(e[n]));for(n=0;n<A[t][l].length;n++)if(r[v](A[t][l][n])){var i=new cc[_](r[v](A[t][l][n]));C.push(i)}L()}));break;default:}}},onClickAdIconBtn:function(){var t="currentAdInfo",r="currentWebPage",n="adType",i="webpage_url",o="clickStat",a="BiLog",s="clickStatEventType",c="navigateToMiniProgram",d="?from=adcross",l="release",f="clickStatEventTypeClickDirectToMiniGameSuccess",u="clickStatEventTypeClickDirectToMiniGameFail",_="resetBtnIcon";try{this.genRandomSecondAdInfo();var h=this[t].icon_skip_type,p=this[t].toappid,I=this[t].togame,g=this[t].path,S=this[t].second_toappid,m=this,v=this[t].icon_id,y="0",A="",T="0";this[r]&&(1==this[n]||3==this[n])&&(A=this[r][i],y=this[r].config_id,T=this[r].webpage_id);var E=[v,y,A,p,I,T,m[n]];if(e[a][o](e[s].clickStatEventTypeClickAdBtn,E),wx&&wx[c])return 1==h?void wx[c]({appId:p,path:g||d,envVersion:l,extraData:{from:g||d},success:function(t){e[a][o](e[s][f],E)},fail:function(t){e[a][o](e[s][u],E)},complete:function(e){m[_]()}}):void(2==h&&wx[c]({appId:S,path:g||d,envVersion:l,extraData:{from:g||d},success:function(t){e[a][o](e[s][f],E)},fail:function(t){e[a][o](e[s][u],E)},complete:function(e){m[_]()}}));if(!m[r]||!m[r][i])return void m[_]();e[a][o](e[s].clickStatEventTypeClickShowQRCode,E),e.IsWechatPlatform()&&wx.previewImage({current:[m[r][i]],urls:[m[r][i]],success:function(t){e.LOGD(null,"预览图片成功！")},fail:function(t){e.LOGD(null,"预览图片失败！")},complete:function(e){m[_]()}})}catch(e){}},resetBtnIcon:function(){this.adIconBtn&&(this.genRandomFirstAdInfo(),this.adIconNode())},onForeGround:function(){this.adIconNode()},showAdNode:function(){this.adIconBtn&&(this.adIconBtn.active=!0)},hideAdNode:function(){this.adIconBtn&&(this.adIconBtn.active=!1)}},freshAdIconByTime:function(){e.AdManager.adNodeList.forEach((function(e){e&&e.resetBtnIcon&&e.resetBtnIcon()}))},freshNewAdIconByTime:function(){e.AdManager.newAdNodeList.forEach((function(e){e&&e.resetBtnIcon&&e.resetBtnIcon()}))},startFreshAdIcon:function(){var t="allAdInfoList",r="length",n="icon_interval",i="iconTimer",o="AdManager",a="newAdPointInfoList",s="newIconTimer";try{var c=10;if(this[t]&&this[t][r]&&this[t][r]>0)for(var d=0;d<this[t][r];d++)if(f=this[t][d][n]){c=parseInt(f)>0?parseInt(f):c;break}e[o][i]&&(clearInterval(e[o][i]),e[o][i]=0),e[o][i]=setInterval(e[o].freshAdIconByTime,1e3*c);var l=10;if(this[a]&&this[a][r]&&this[a][r]>0)for(d=0;d<this[a][r];d++){var f;if(f=this[a][d][n]){l=parseInt(f)>0?parseInt(f):l;break}}e[o][s]&&(clearInterval(e[o][s]),e[o][s]=0),e[o][s]=setInterval(e[o].freshNewAdIconByTime,1e3*l)}catch(e){}},onForeGround:function(){this.freshAdIconByTime(),this.freshNewAdIconByTime(),this.startFreshAdIcon()},getConfigSignStr:function(t){for(var r=Object.keys(t).sort(),n="",i=0;i<r.length;i++){var o=r[i];"act"!=o&&"sign"!=o&&(n+=o+"="+t[o])}return e.hex_md5("market.tuyoo.com-api-"+n+"-market.tuyoo-api")||""},requestADInfo:function(){var t="openFeatureFilter",r="SystemInfo",n="userId",i="UserInfo",o="retryCrossTimes",a="requestADInfo";try{if(!e.IsWechatPlatform())return;if(e[r][t]&&!e[i][n])return;this[o]--;var s={},c=(new Date).getTime();s.act="api.getCrossConfig",s.time=c,s.game_mark=e[r].cloudId+"-"+e[r].gameId,e[r][t]&&e[i][n]&&(s.user_id=e[i][n]);var d=this.getConfigSignStr(s),l=[];for(var f in s)l.push(f+"="+s[f]);l.push("sign="+d);var u=e[r].shareManagerUrl+"?"+l.join("&"),_=this;wx.request({url:u,method:"GET",success:function(e){if(200==e.statusCode){var t=e.data;_.allAdInfoList=[],t.retmsg&&(_.rawAdInfoList=t.retmsg,_.processIconConfigInfo()),_[o]=3}else _[o]>0?_[a]():_[o]=3},fail:function(e){_[o]>0?_[a]():_[o]=3}})}catch(t){e.LOGE("error:","tywx.AdManager.requestADInfo——"+JSON.stringify(t))}},requestNewAdInfo:function(){var t="openFeatureFilter",r="SystemInfo",n="userId",i="UserInfo",o="retryNewAdTimes",a="requestNewAdInfo";try{if(!e.IsWechatPlatform())return;if(e[r][t]&&!e[i][n])return;this[o]--;var s={},c=(new Date).getTime();s.act="api.getCrossConfigNew",s.time=c,s.game_mark=e[r].cloudId+"-"+e[r].gameId,e[r][t]&&e[i][n]&&(s.user_id=e[i][n]);var d=this.getConfigSignStr(s),l=[];for(var f in s)l.push(f+"="+s[f]);l.push("sign="+d);var u=e[r].shareManagerUrl+"?"+l.join("&"),_=this;wx.request({url:u,method:"GET",success:function(e){if(200==e.statusCode){var t=e.data;_.allNewAdInfoDict={},t.retmsg&&(_.rawNewAdInfoDict=t.retmsg,_.processNewIconConfigInfo()),_[o]=3}else _[o]>0?_[a]():_[o]=3},fail:function(e){_[o]>0?_[a]():_[o]=3}})}catch(t){e.LOGE("error:","tywx.AdManager.requestNewADInfo——"+JSON.stringify(t))}},processRawConfigInfo:function(){this.processIconConfigInfo(),this.processNewIconConfigInfo()},processIconConfigInfo:function(){var t="allAdInfoList",r="rawAdInfoList",n="icon_weight",i="UserInfo",o=this;this[t]=[],null!=this[r]&&(this[r].forEach((function(r){(null==r[n]||Math.floor(r[n])<=.1)&&(r[n]=0);for(var a=!1,s=r.push_uids||[],c=0,d=s.length;c<d;c++)if(e[i].userId.toString()==s[c]&&e[i].userId){a=!0;break}var l=!1,f=r.phone_type,u=0;switch(e[i].systemType.toString()){case"3":u=1;break;case"1":case"2":case"4":u=2}0!=f&&f!=u||(l=!0),(a||l)&&o[t].push(r)})),e.NotificationCenter.trigger(e.EventType.GET_ADMANAGER_ICON_INFO_SUCCESS,this[t]))},processNewIconConfigInfo:function(){var t="allNewAdInfoDict",r="rawNewAdInfoDict",n="icon_weight",i="UserInfo",o=this;if(this[t]={},null!=this[r]){for(var a=Object.keys(this[r]),s=0,c=a.length;s<c;s++){var d=this[r][a[s]];o[t][a[s]]=[],0<d.length&&d.forEach((function(r){(null==r[n]||Math.floor(r[n])<=.1)&&(r[n]=0);var c=!1,d=r.push_uids||[];for(var l in d)if(e[i].userId.toString()==d[l]&&e[i].userId){c=!0;break}var f=!1,u=r.phone_type,_=0;switch(e[i].systemType.toString()){case"3":_=1;break;case"1":case"2":case"4":_=2}0!=u&&u!=_||(f=!0),(c||f)&&o[t][a[s]].push(r)}))}e.NotificationCenter.trigger(e.EventType.GET_ADMANAGER_NEWICON_INFO_SUCCESS,this[t])}},init:function(){this.requestADInfo(),this.requestNewAdInfo()}},e.AdManager.adNodeClass.prototype=e.AdManager.adNodeObj,e.TYPayInterface={pay:function(t,r){var n=null,i="chargeType",o="SystemInfo",a="sdk_order_track_id",s="prodOrderId",c="sdk_game_zone_id",d="default",l="sdk_game_role_id",f="innerTrack",u="GALog",_="GA_TYPE",h="GAEventType",p="sdk_order_id";if(void 0===t.actId||t.actId===n)if(t!=n&&t.prodId!=n){t[i]==n&&(t[i]="1.0"===e[o].wxPayVersion?"wxapp.iap":"wxapp.iap.v2"),t[a]=e.Util.createUUID(),t.gameId=e[o].gameId;var I={sdk_product_id:t.prodId,sdk_pay_type:t[i],sdk_game_order_id:t[s]?t[s]:"",sdk_game_zone_id:t[c]?t[c]:d,sdk_game_role_id:t[l]?t[l]:d,sdk_order_track_id:t[a]};e[u][f](e[u][_].PAY,e[h].SDK_PAY_START,I);var g=function(t,n,i){0!=t?(I.sdk_error_msg=i,I.sdk_error_code=t,e[u][f](e[u][_].PAY,e[h].SDK_PAY_FAIL,I)):(I[p]=n[p],e[u][f](e[u][_].PAY,e[h].SDK_PAY_SUCC,I)),r&&r(t,n,i)};"wxwap"===t[i]?this.qrCodePay(t,g):this.rechargeOrder(t,g)}else r&&r(-1,{},"Required information cannot be empty!");else this.showWXPopup(t,r)},createOrder:function(t,r,n,i,o,a){var s="SystemInfo",c={};c.prodId=t,c.prodPrice=r,c.chargeType="1.0"===e[s].wxPayVersion?"wxapp.iap":"wxapp.iap.v2",c.gameId=e[s].gameId,c.prodName=n,c.prodCount=i,c.appInfo=a,c.prodOrderId=o,e.TYPayInterface.pay(c,null)},orderCallFunc:function(t,r,n){var i="prodOrderId",o="sdk_game_zone_id",a="sdk_game_role_id",s="sdk_order_track_id",c="innerTrack",d="GALog",l="GA_TYPE",f="SystemInfo",u="getLocalUUID",_="sdk_error_msg",h="stringify",p="sdk_c_charge_callback_fail",I={sdk_product_id:t.prodId,sdk_pay_type:t.chargeType,sdk_game_order_id:t[i]?t[i]:"",sdk_game_zone_id:t[o]?t[o]:"",sdk_game_role_id:t[a]?t[a]:"",sdk_order_id:n,sdk_order_track_id:t[s]?t[s]:""};e[d][c](e[d][l].PAY,"sdk_c_charge_callback_start",I),wx.request({url:r,header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:e.UserInfo.userId,appId:e[f].appId,wxAppId:e[f].wxAppId,clientId:e[f].clientId,imei:"null",uuid:e.Util[u](),platformOrderId:n,osName:e.UserInfo.platform,original_deviceid:e.Util[u](),sdk_game_zone_id:t[o]?t[o]:"",sdk_game_role_id:t[a]?t[a]:"",sdk_order_track_id:t[s]},method:"POST",success:function(t){var r=t.data.result;if(r){if(r&&0==r.code)return void e[d][c](e[d][l].PAY,"sdk_c_charge_callback_succ",I);I.sdk_error_code=r.code,I[_]=JSON[h](t.data)}else I[_]=JSON[h](t.data);e[d][c](e[d][l].PAY,p,I)},fail:function(t){I[_]=JSON[h](t),e[d][c](e[d][l].PAY,p,I),e.LOGE(null,"file = [Recharge] fun = [OrderCallFun] 充值失败 params = "+JSON[h](t))},complete:function(e){}})},rechargeOrder:function(t,r){var n="chargeType",i="prodOrderId",o="sdk_game_zone_id",a="sdk_game_role_id",s="sdk_order_track_id",c="innerTrack",d="GALog",l="GA_TYPE",f="SystemInfo",u="getLocalUUID",_="mustcharge",h="extraParams",p="stringify",I="trigger",g="NotificationCenter",S="EventType",m="isPopupPay",v="TYPayInterface",y="CREATE_PAY_ORDER_FAIL",A="sdk_c_order_fail",T="sdk_error_msg";try{if(!e.IsWechatPlatform())return void(r&&r(1,{},"Is not wechat platform"));var E={sdk_product_id:t.prodId,sdk_pay_type:t[n],sdk_game_order_id:t[i]?t[i]:"",sdk_game_zone_id:t[o]?t[o]:"",sdk_game_role_id:t[a]?t[a]:"",sdk_order_track_id:t[s]};e[d][c](e[d][l].PAY,"sdk_c_order_start",E);var C={userId:e.UserInfo.userId,appId:e[f].appId,wxAppId:e[f].wxAppId,clientId:e[f].clientId,imei:"null",uuid:e.Util[u](),prodId:t.prodId,prodName:t.prodName,prodCount:t.prodCount||1,prodPrice:t.prodPrice,chargeType:t[n],gameId:t.gameId,appInfo:t.appInfo||"",mustcharge:t[_]||1,prodOrderId:t[i]||"",osName:e.UserInfo.platform,original_deviceid:e.Util[u](),sdk_game_zone_id:t[o]?t[o]:"",sdk_game_role_id:t[a]?t[a]:"",sdk_order_track_id:t[s]};if(t[h])for(var L in t[h])C[L]=t[h][L];wx.request({method:"POST",url:e[f].loginUrl+"open/v4/pay/order",header:{"content-type":"application/x-www-form-urlencoded"},data:C,success:function(n){e.LOGE(null,"tuyoo rechargeOrder success, params:"+JSON[p](n));var i=n.data.result;if(i&&0==i.code){var o=i.chargeInfo,a=o.chargeData,s=a.notifyUrl,f=a.platformOrderId;e.LOGE(null,"tuyoo rechargeOrder success 创建订单成功, chargeData.mustcharge ="+a[_]),E.sdk_order_id=f,e[d][c](e[d][l].PAY,"sdk_c_order_succ",E),a&&1==a[_]?(e[g][I](e[S].CREATE_PAY_ORDER_SUCCESS,n),void 0!==t[m]&&!0===t[m]?e[v].callWXPopupPay(E,o,a,r,t):e[v].callWXPay(E,a,r,t)):(e[g][I](e[S][y],n),e[v].orderCallFunc(t,s,f),E.sdk_error_code=i.code,e[d][c](e[d][l].PAY,A,E),r&&r(4,{},JSON[p](n)))}else e[g][I](e[S][y],n),E[T]=JSON[p](n.data),e[d][c](e[d][l].PAY,A,E),r&&r(4,{},JSON[p](n))},fail:function(t){e[g][I](e[S][y],t),E[T]=JSON[p](t),e[d][c](e[d][l].PAY,A,E),r&&r(3,{},JSON[p](t))},complete:function(e){}})}catch(e){r&&r(-1,{},JSON[p](e))}},callWXPay:function(t,r,n,i){var o="buyQuantity",a="TYPayInterface",s=r[o]?r[o]:10*chargeInfo.chargeTotal;t.sdk_event_tips=r.env,t.sdk_channel_mch_id=r.offerId,e.GALog.innerTrack(e.GALog.GA_TYPE.PAY,"sdk_c_request_channel_pay_start",t),wx.requestMidasPayment({mode:r.mode,env:r.env,offerId:r.offerId,buyQuantity:s,platform:r.platform,currencyType:"CNY",zoneId:r.zoneId,success:function(o){e[a].processWXPaySucc(o,t,r,n,i)},fail:function(o){e[a].processWXPayFail(o,t,r,n,i)}})},callWXPopupPay:function(t,r,n,i,o){var a="TYPayInterface";t.sdk_event_tips=JSON.stringify({evn:n.env,isPopupPay:"true"}),t.sdk_channel_mch_id=n.offerId,e.GALog.innerTrack(e.GALog.GA_TYPE.PAY,"sdk_c_request_channel_pay_start",t);const s=GameGlobal.miniGameCommon.createPopupActivity();var c={offerId:n.offerId,outTradeNo:n.platformOrderId,exchangeRate:parseInt(n.buyQuantity/r.chargeTotal),zoneId:n.zoneId,env:n.env};s.requestMidasPayment(c).then((function(r){e[a].processWXPaySucc(r,t,n,i,o)})).catch((function(r){e[a].processWXPayFail(r,t,n,i,o)}))},processWXPaySucc:function(t,r,n,i,o){e.NotificationCenter.trigger(e.EventType.SDK_WX_PAY_SUCCESS,t),e.GALog.innerTrack(e.GALog.GA_TYPE.PAY,"sdk_c_request_channel_pay_succ",r),i&&i(0,r,""),e.TYPayInterface.orderCallFunc(o,n.notifyUrl,n.platformOrderId)},processWXPayFail:function(t,r,n,i,o){var a="errCode",s="stringify";e.NotificationCenter.trigger(e.EventType.SDK_WX_PAY_FAIL,t),r.sdk_channel_error_code=t[a],r.sdk_channel_error_msg=JSON[s](t),e.GALog.innerTrack(e.GALog.GA_TYPE.PAY,"sdk_c_request_channel_pay_fail",r),e.LOGE(null,"米大师组件支付 fail res = "+JSON[s](t)),t[a]&&(2==t[a]||1==t[a]||-2==t[a])&&e.TYPayInterface.cancelOrder(o,n.platformOrderId),i&&i(5,{},JSON[s](t))},cancelOrder:function(t,r){var n="SystemInfo",i="sdk_game_zone_id",o="sdk_game_role_id",a="sdk_order_track_id",s="stringify";try{var c=e[n].loginUrl+"open/v4/pay/cancelorder",d={platformOrderId:r,appId:e[n].appId,userId:e.UserInfo.userId,clientId:e[n].clientId,payType:t.chargeType,osName:e.UserInfo.platform,original_deviceid:e.Util.getLocalUUID(),sdk_game_zone_id:t[i]?t[i]:"",sdk_game_role_id:t[o]?t[o]:"",sdk_order_track_id:t[a]?t[a]:""};wx.request({url:c,header:{"content-type":"application/x-www-form-urlencoded"},data:d,method:"POST",success:function(t){e.LOGE(null,"tuyoo cancelOrder success, params:"+JSON[s](t))},fail:function(t){e.LOGE(null,"tuyoo cancelOrder fail, params:"+JSON[s](t))},complete:function(e){}})}catch(e){}},qrCodePay:function(t,r){var n="sdk_game_role_id",i="prodOrderId",o="extraParams",a="tempFilePath",s="showQRCode",c="https://tywx.tuyoo.com/gameclient/GameChargeCon/payQrcode?",d={appId:e.SystemInfo.wxAppId,prodId:t.prodId,prodName:t.prodName,prodPrice:t.prodPrice,userId:e.UserInfo.userId,roleId:t[n]?t[n]:e.UserInfo.userId,appInfo:t.appInfo?t.appInfo:"",prodOrderId:t[i]?t[i]:""};if(t[o])for(var l in t[o])d[l]=t[o][l];for(var l in d)c=c.endsWith("&")?c+l+"="+d[l]:c+"&"+l+"="+d[l];wx.showLoading({title:"加载中"}),wx.downloadFile({url:c,header:{"content-type":"application/x-www-form-urlencoded"},success:function(n){if(200===n.statusCode){var i={qrCode:n[a],sdk_product_id:t.prodId};r&&r(0,i,""),t[s]&&e.TYPayInterface[s](n[a])}else r&&r(4,{},JSON.stringify(params))},fail:function(e){r&&r(3,{},JSON.stringify(e))},complete:function(e){wx.hideLoading()}})},canvas:null,canvasContext:null,showQRCode:function(t){var r="canvas",n="TYPayInterface",i="width",o="pixelRatio",a="height",s=wx.createImage();e[n][r]||(e[n][r]=wx.createCanvas());var c=e[n][r];s.onload=function(){const t=wx.getSystemInfoSync();c[i]=t.screenWidth*t[o],c[a]=t.screenHeight*t[o];var r=c.getContext("2d");e[n].canvasContext=r,wx.onTouchEnd(e[n].canvasTouchEventListener);var s=Math.min(c[i]/this[i],c[a]/this[a]);r.scale(s,s),r.drawImage(this,(c[i]-this[i]*s)/s/2,(c[a]-this[a]*s)/s/2)},s.src=t},canvasTouchEventListener:function(){var t="canvasContext",r="TYPayInterface",n="pixelRatio";const i=wx.getSystemInfoSync();e[r][t]&&e[r][t].clearRect(0,0,i.screenWidth*i[n],i.screenHeight*i[n]),wx.offTouchEnd(e[r].canvasTouchEventListener)},showWXPopup:function(r,n){var i="miniGameCommon",o="createPopupActivity",a="sdk_game_zone_id";if(t||e.getWXPlugin(),GameGlobal[i]&&GameGlobal[i][o]){const t=GameGlobal[i][o]();var s={actId:r.actId,levelList:r.levelList};t.showPopup(s).then((function(t){var i=JSON.parse(t.payInfo),o={prodId:i.proId,prodPrice:i.proPrice,prodName:"",appInfo:r.appInfo,prodOrderId:r.prodOrderId,sdk_game_zone_id:r[a],sdk_game_zone_id:r[a],isPopupPay:!0};e.TYPayInterface.pay(o,n)})).catch((function(e){n&&n(-1,e.info)}))}else n&&n(-1,"createPopupActivity error!")}};var t=!1;e.getWXPlugin=function(){try{if("undefined"!=typeof requirePlugin){const e=(0,requirePlugin("MiniGameCommon",{enableRequireHostModule:!0,customEnv:{wx:wx}}).default)();void 0===e||void 0===e.canIUse||(t=!0,GameGlobal.miniGameCommon=e)}}catch(e){}},e.onShareAppMessageInit(),module.exports={tywx:e};